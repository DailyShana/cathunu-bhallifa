\documentclass[12pt,UTF8]{ctexbook}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{subcaption}

% % 导入设定
\input{../shared/settings}

% % 封面
% \title{\zihao{0} \bfseries 测试页}
% \author{\zihao{2} \texttt{大青花鱼}}
% % \date{\bfseries\today}
% \date{}
% % 正文
% \begin{document}
% \maketitle
% \tableofcontents
% \newpage
\usepackage{tikz}
\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\usetikzlibrary{calc,arrows.meta}

\begin{document}

% \section{问题背景}
% 研究某城市25-35岁居民的教育年限（$Y$，单位：年）与年收入（$X$，单位：万元）的关系。随机抽样1000名居民，得到联合分布数据如下：

% \section{数据分布}
% \begin{table}[h!]
% \centering
% \caption{教育年限与收入的联合频数分布（样本量$n=1000$）}
% \label{tab:joint-dist}
% \begin{tabular}{c|ccccc|c}
% \toprule
% \multirow{2}{*}{$X$\textbackslash $Y$} & \multicolumn{4}{c}{教育年限 $Y$ (年)} & \multirow{2}{*}{合计} \\
% & 12 & 16 & 18 & 20 & \\
% \midrule
% 10 & 140 & 40 & 10 & 0 & 190 \\
% 20 & 90 & 140 & 40 & 10 & 280 \\
% 30 & 40 & 90 & 100 & 40 & 270 \\
% 40 & 10 & 40 & 80 & 60 & 190 \\
% 50 & 0 & 10 & 20 & 40 & 70 \\
% \hline
% 合计 & 280 & 320 & 250 & 150 & 1000 \\
% \bottomrule
% \end{tabular}
% \end{table}

% \section{基于事件的条件分布}
% 定义随机事件：
% \[
% A_1 = \{Y \leq 16\} \quad (\text{高等教育以下}), \quad 
% A_2 = \{Y > 16\} \quad (\text{高等教育以上})
% \]

% \subsection{条件概率计算}
% \begin{align*}
% P(A_1) &= \frac{280 + 320}{1000} = 0.6, \quad 
% P(A_2) = \frac{250 + 150}{1000} = 0.4 \\
% P(X=x|A_1) &= \frac{P(X=x, Y\leq16)}{P(A_1)}, \quad 
% P(X=x|A_2) = \frac{P(X=x, Y>16)}{P(A_2)}
% \end{align*}

% \begin{table}[h!]
% \centering
% \caption{条件分布 $P(X|A_1)$ 和 $P(X|A_2)$}
% \label{tab:event-cond}
% \begin{tabular}{c|cc|cc}
% \toprule
% \multirow{2}{*}{收入 $X$} & \multicolumn{2}{c|}{频数} & \multicolumn{2}{c}{条件概率} \\
% & $A_1$ & $A_2$ & $P(X|A_1)$ & $P(X|A_2)$ \\
% \midrule
% 10 & 180 & 10 & 0.300 & 0.025 \\
% 20 & 230 & 50 & 0.383 & 0.125 \\
% 30 & 130 & 140 & 0.217 & 0.350 \\
% 40 & 50 & 140 & 0.083 & 0.350 \\
% 50 & 10 & 60 & 0.017 & 0.150 \\
% \hline
% 合计 & 600 & 400 & 1.000 & 1.000 \\
% \bottomrule
% \end{tabular}
% \end{table}

% \subsection{分布可视化}
% \begin{figure}[h!]
% \centering
% \begin{tikzpicture}
% \begin{axis}[
%     ybar, 
%     bar width=6mm,
%     title={事件条件对收入分布的影响},
%     xlabel={收入 \(X\) (万元)},
%     ylabel={概率},
%     symbolic x coords={10,20,30,40,50},
%     xtick=data,
%     legend pos=north west,
%     ymajorgrids=true,
%     width=0.9\textwidth,
%     height=0.6\textwidth
% ]
% \addplot coordinates {(10,0.300) (20,0.383) (30,0.217) (40,0.083) (50,0.017)};
% \addplot coordinates {(10,0.025) (20,0.125) (30,0.350) (40,0.350) (50,0.150)};
% \legend{\(X|A_1\) (教育≤16年), \(X|A_2\) (教育>16年)}
% \end{axis}
% \end{tikzpicture}
% \caption{事件条件对收入分布的影响}
% \label{fig:event-cond}
% \end{figure}

% \section{基于随机变量的条件分布}
% 定义条件随机变量 $X|Y=y$ 的概率质量函数：
% \[
% P(X=x|Y=y) = \frac{P(X=x,Y=y)}{P(Y=y)}
% \]

% \begin{table}[h!]
% \centering
% \caption{条件分布 $P(X|Y=y)$ 随教育年限 $y$ 的变化}
% \label{tab:rv-cond}
% \begin{tabular}{c|cccc}
% \toprule
% \multirow{2}{*}{收入 $X$} & \multicolumn{4}{c}{教育年限 $Y=y$ (年)} \\
% & 12 & 16 & 18 & 20 \\
% \midrule
% 10 & 0.500 & 0.125 & 0.040 & 0.000 \\
% 20 & 0.321 & 0.438 & 0.160 & 0.067 \\
% 30 & 0.143 & 0.281 & 0.400 & 0.267 \\
% 40 & 0.036 & 0.125 & 0.320 & 0.400 \\
% 50 & 0.000 & 0.031 & 0.080 & 0.267 \\
% \hline
% 合计 & 1.000 & 1.000 & 1.000 & 1.000 \\
% \bottomrule
% \end{tabular}
% \end{table}

% \subsection{分布可视化}
% \begin{figure}[h!]
% \centering
% \begin{tikzpicture}
% \begin{axis}[
%     ybar, 
%     bar width=4mm,
%     title={不同教育年限下的收入分布},
%     xlabel={收入 \(X\) (万元)},
%     ylabel={概率},
%     symbolic x coords={10,20,30,40,50},
%     xtick=data,
%     legend style={at={(0.5,-0.2)}, anchor=north, legend columns=4},
%     ymajorgrids=true,
%     width=1.0\textwidth,
%     height=0.6\textwidth
% ]
% \addplot coordinates {(10,0.500) (20,0.321) (30,0.143) (40,0.036) (50,0.000)};
% \addplot coordinates {(10,0.125) (20,0.438) (30,0.281) (40,0.125) (50,0.031)};
% \addplot coordinates {(10,0.040) (20,0.160) (30,0.400) (40,0.320) (50,0.080)};
% \addplot coordinates {(10,0.000) (20,0.067) (30,0.267) (40,0.400) (50,0.267)};
% \legend{\(Y=12\), \(Y=16\), \(Y=18\), \(Y=20\)}
% \end{axis}
% \end{tikzpicture}
% \caption{不同教育水平下的条件收入分布}
% \label{fig:rv-cond}
% \end{figure}

% \section{关键结论}
% \begin{enumerate}
% \item \textbf{事件条件改变分布形状}：从图\ref{fig:event-cond}可见：
%   \begin{itemize}
%   \item $X|A_1$ 呈右偏分布（众数20万）
%   \item $X|A_2$ 呈钟形分布（众数30-40万）
%   \end{itemize}
  
% \item \textbf{随机变量条件精细调节分布}：从图\ref{fig:rv-cond}可见：
%   \begin{align*}
%   \text{教育水平 } \uparrow \quad \Rightarrow \quad & \text{低收入概率} \downarrow \\
%   & \text{高收入概率} \uparrow \\
%   & \text{分布中心} \rightarrow \text{右移}
%   \end{align*}
  
% \item \textbf{期望收入对比}：
%   \begin{align*}
%   E[X|A_1] &= 21.8 \text{ 万元}, \quad 
%   E[X|A_2] = 33.5 \text{ 万元} \\
%   E[X|Y=12] &= 18.2 \text{ 万元}, \quad 
%   E[X|Y=16] = 24.8 \text{ 万元} \\
%   E[X|Y=18] &= 32.4 \text{ 万元}, \quad 
%   E[X|Y=20] = 37.3 \text{ 万元}
%   \end{align*}
% \end{enumerate}

% \section{理论启示}
% \begin{itemize}
% \item \textbf{事件条件} ($X|A$)：生成\textbf{单一}条件分布，通过事件$A$改变样本空间
% \item \textbf{随机变量条件} ($X|Y=y$)：生成\textbf{分布族}，展示$X$如何随$Y$取值变化
% \item \textbf{分布演化}：当$Y$连续时，$X|Y=y$可形成条件密度曲面
% \item \textbf{应用意义}：条件期望$E[X|Y]$是最小均方预测器
% \end{itemize}


% \begin{tikzpicture}[scale=0.75]
%     % 方城参数
%     \pgfmathsetmacro{\citySize}{4}    % 方城边长
%     \pgfmathsetmacro{\treeNorth}{1}   % 北门出城100步
%     \pgfmathsetmacro{\walkSouth}{1}   % 南门出城100步
%     \pgfmathsetmacro{\walkWest}{12}    % 西行1200步
%     \pgfmathsetmacro{\door}{0.24}    % 城门用

%     % 绘制坐标轴
%     \draw[->] (-12.8,0) -- (3,0) node[below right] {$x(100\mbox{\texttt{步}})$};
%     \draw[->] (0,-3.5) -- (0,4.8) node[below right] {$y(100\mbox{\texttt{步}})$};

%     \foreach \x in {-12,...,-1} {
%         \draw (\x,0) -- (\x,-0.1);
%         \node [below] at (\x,0) {\x};
%     }
    
%     \foreach \x in {1,2} {
%         \draw (\x,0) -- (\x,-0.1);
%         \node [below] at (\x,0) {\x};
%     }

%     \foreach \y in {-3,...,-1} {
%         \draw (0,\y) -- (-0.1,\y);
%         \node [left] at (0,\y) {\y};
%     }

%     \foreach \y in {1,...,4} {
%         \draw (0,\y) -- (-0.1,\y);
%         \node [left] at (0,\y) {\y};
%     }

%     % 绘制方城（以原点为中心）
%     \draw[thick, draw=Sepia] (-\citySize/2, -\citySize/2) rectangle (\citySize/2, \citySize/2);
%     \draw[thick, draw=Sepia] (-\door/2, \citySize/2) -- (-\door/2, \citySize/2 + \door/2);
%     \draw[thick, draw=Sepia] (\door/2, \citySize/2) -- (\door/2, \citySize/2 + \door/2);
%     \draw[thick, draw=Sepia] (-\door/2, -\citySize/2) -- (-\door/2, -\citySize/2 - \door/2);
%     \draw[thick, draw=Sepia] (\door/2, -\citySize/2) -- (\door/2, -\citySize/2 - \door/2);
%     \draw[thick, draw=Sepia] (\citySize/2, -\door/2) -- (\citySize/2 + \door/2, -\door/2);
%     \draw[thick, draw=Sepia] (\citySize/2, \door/2) -- (\citySize/2 + \door/2, \door/2);
%     \draw[thick, draw=Sepia] (-\citySize/2, -\door/2) -- (-\citySize/2 - \door/2, -\door/2);
%     \draw[thick, draw=Sepia] (-\citySize/2, \door/2) -- (-\citySize/2 - \door/2, \door/2);
    
%     % 绘制树
%     \node[draw, circle, fill=green!50!black, inner sep=2pt] at (0, \citySize/2 + \treeNorth) {};
%     \node[above] at (0, \citySize/2 + \treeNorth) {};
    
%     % 绘制南门出城路径
%     \draw[-{Latex[length=2.5mm,width=2mm]}, thick, draw=red] (0, \citySize/2) -- node[right] {\texttt{北门出城直走}$100$\texttt{步}}  (0, \citySize/2 + \walkSouth);
%     \draw[thick, draw=red] (0, -\citySize/2) -- (0, -\citySize/2 - \walkSouth);
%     \draw[-{Latex[length=2.5mm,width=2mm]}, thick, draw=red] (0, -\citySize/2 - \walkSouth) -- node[above] {\texttt{南门出城直走}$100$\texttt{步转西走}$1200$\texttt{步}} (-\walkWest, -\citySize/2 - \walkSouth);
    
%     % 绘制视角线
%     \draw[dashed] (0, \citySize/2 + \treeNorth) -- (-\walkWest, -\citySize/2 - \walkSouth);

%     \draw[-{Stealth[length=6mm,width=3mm]}, thick] (-10,3) -- (-10, 3.5);
%     \node[above] at (-10, 3.5) {\texttt{北}};
    
% \end{tikzpicture}

% \newpage

% \begin{align*}
%     22 \times 3000 \times b + 50000 \times (m - 5) &= 66000\cdot \left(-m - 1 - \sum_{i=0}^{5+m} \frac{i\e^{-4}4^i}{i!} + (5+m) \sum_{i=0}^{5} \frac{\e^{-4}4^i}{i!} \right) + 50000 \cdot (m - 5) \\
%     &= 6\dlim{6000}\cdot \left((5+m) \sum_{i=0}^{5} \frac{\e^{-4}4^i}{i!} - \sum_{i=0}^{5+m} \frac{i\e^{-4}4^i}{i!}\right) -1\dlim{6000} m - 31\dlim{6000}  
% \end{align*}

% \begin{tikzpicture}
%     \begin{axis}[
%         width=12cm, height=6cm,
%         xlabel={},
%         ylabel={\texttt{概率}},
%         xtick={1,2,...,12},
%         ytick={0,0.05,...,0.4},
%         ymin=0, ymax=0.45,
%         xmin=0, xmax=12,
%         grid=both,
%         grid style={line width=.1pt, draw=gray!30, dashed},
%         axis lines=middle,
%         enlargelimits={upper=0.1},
%         yticklabel style={
%             /pgf/number format/fixed,
%             /pgf/number format/precision=2
%         }
%     ]
    
%     % 定义二项分布的概率质量函数
%     \pgfmathdeclarefunction{binomial}{1}{%
%       \pgfmathparse{(0.4) * ((1 - 0.4)^(\x - 1))}%
%     }
    
%     \addplot+[ybar, samples at={1,2,...,12}, fill=Sepia!30] 
%         (\x, {binomial(\x)});
        
%     \end{axis}
    
%     \node [below] at (10.2cm,-0.18cm) {$\ldots$};

%     \node [above] at (9.6cm,0.14cm) {\texttt{随机变量值}};

%     \node [below, align=center] at (6cm, -1cm) {\texttt{系数}$p=0.4$\texttt{的等比分布}};

% \end{tikzpicture}
    

% \newpage

% \begin{tikzpicture}
%     \begin{axis}[
%         width=12cm, height=6cm,
%         xlabel={},
%         ylabel={\texttt{概率}},
%         xtick={0,2,...,20},
%         ytick={0,0.02,...,0.12},
%         ymin=0, ymax=0.12,
%         xmin=0, xmax=20,
%         yticklabel style={
%             /pgf/number format/fixed,
%             /pgf/number format/precision=2
%         },
%         grid=both,
%         grid style={line width=.1pt, draw=gray!30, dashed},
%         axis lines=middle,
%         enlargelimits={upper=0.1}
%     ]
    
%     % 定义泊松分布的概率质量函数
%     \pgfmathdeclarefunction{poisson}{1}{%
%       \pgfmathparse{exp(-#1) * (#1^\x) / \x!}%
%     }
    
%     \addplot+[ybar, samples at={0,...,20}, fill=Sepia!30] 
%         (\x, {poisson(10)});
    
%     \end{axis}
    
%     \node [below] at (10.2cm,-0.18cm) {$\ldots$};

%     \node [above] at (9.6cm,0.14cm) {\texttt{随机变量值}};

%     \node [below, align=center] at (6cm, -1cm) {\texttt{系数}$a=10$\texttt{的指数分布}};
    
% \end{tikzpicture}

% \begin{tikzpicture}

% \def\maxDots{12}
% \def\maxRollValue{6}

% \def\xunit{0.9cm}
% \def\yunit{0.5cm}
% \def\xdif{0.9}
% \def\ydif{0.5}

% \draw [->,line width=1pt,>={Stealth[]}] (0,0) -- (\maxDots*\xunit,0) node[above left] {总点数};
% \draw [->,line width=1pt,>={Stealth[]}] (0,0) -- (0,\maxRollValue*\yunit+1.5*\yunit);

% \foreach \x in {2,...,\maxDots} {
%     \draw (\x*\xunit-\xunit,0) -- (\x*\xunit-\xunit,-0.1*\yunit);
%     \node [below] at (\x*\xunit-\xunit,0) {\x};
% }

% \foreach \y in {1,...,\maxRollValue} {
%     \draw (0,\y*\yunit) -- (-0.1*\xunit,\y*\yunit);
%     \node [left] at (0,\y*\yunit) {\y};
% }

% \node [below left] at (0,0) {O};

% \foreach \i in {1,...,\maxRollValue} {
%     \foreach \j in {\i,...,\maxRollValue} {
%         \pgfmathsetmacro{\maxVal}{max(\i,\j)}
%         \pgfmathsetmacro{\minVal}{min(\i,\j)}
%         \pgfmathsetmacro{\sumVal}{\i+\j}
        
%         \draw [red!80!black, fill=red!10] ($(\sumVal*\xunit-\xunit,\maxVal*\yunit) + (-0.4*\xunit, -0.4*\yunit)$) rectangle ($(\sumVal*\xunit-\xunit,\maxVal*\yunit) + (0.4*\xunit, 0.4*\yunit)$);
%         \draw [red!80!black, fill=red!10] ($(\sumVal*\xunit-\xunit,\minVal*\yunit) + (-0.4*\xunit, -0.4*\yunit)$) rectangle ($(\sumVal*\xunit-\xunit,\minVal*\yunit) + (0.4*\xunit, 0.4*\yunit)$);
%         \node [font=\scriptsize] at (\sumVal*\xunit-\xunit,\maxVal*\yunit) {(\i,\j)};
%         \node [font=\scriptsize] at (\sumVal*\xunit-\xunit,\minVal*\yunit) {(\j,\i)};
%     }
% }

% % 新增直方图部分
% \begin{scope}[yshift=-4cm]
%     \foreach \sumVal/\probability in {2/1,3/2,4/3,5/4,6/5,7/6,8/5,9/4,10/3,11/2,12/1} {
%         \pgfmathsetmacro{\barHeight}{\probability*\ydif}
%         \draw [red!80!black, fill=red!20, fill opacity=0.5] (\sumVal*\xdif-\xdif-0.4*\xdif,0) rectangle (\sumVal*\xdif+0.4*\xdif-\xdif,\barHeight);
%         % \node [below] at (\sumVal*\xdif-\xdif, -0.2*\ydif) {\sumVal};
%         % \node [left] at (\sumVal*\xdif-0.6*\xdif, \barHeight/2) {\probability};
%     }
%     \draw [->, line width=1pt, >={Stealth[]}, line cap=round] (0,0) -- (\maxDots*\xunit, 0);
%     \draw [line width=1pt, >={Stealth[]}, line cap=round] (0,0) -- (0, \maxRollValue*\yunit + 3*\yunit);
%     \node [below left] at (0,0) {O};
%     \foreach \x in {2,...,\maxDots} {
%         \draw (\x*\xunit-\xunit,0) -- (\x*\xunit-\xunit,-0.1*\yunit);
%         \node [below] at (\x*\xunit-\xunit,0) {\x};
%     }
    
%     \foreach \y in {1,...,\maxRollValue} {
%         \draw (0,\y*\yunit) -- (-0.1*\xunit,\y*\yunit);
%         \node [left] at (0,\y*\yunit) {\y/36};
%     }
% \end{scope}

% \end{tikzpicture}

% \(\bmat{f}[B] \touying{(\mathbf{a}, \mathbf{b})}, \quad \fanshe{(\mathbf{a}, \mathbf{b})}, \quad \xuan{(\mathbf{a}, \mathbf{b})}\)

% \begin{tikzpicture}[scale=1, tdplot_main_coords]
%     \def\n{5} % 设置 n=3

%     % 绘制网格（可选）
%     \foreach \x in {0,1,...,\n}
%         \draw[grid3, thin] (\x,0,0) -- (\x,\n,0);
%     \foreach \x in {0,1,...,\n}
%         \draw[grid3, thin] (\x,0,0) -- (\x,0,\n);
%     \foreach \y in {0,1,...,\n}
%         \draw[grid3, thin] (0,\y,0) -- (\n,\y,0);
%     \foreach \y in {0,1,...,\n}
%         \draw[grid3, thin] (0,\y,0) -- (0,\y,\n);
%     \foreach \z in {0,1,...,\n}
%         \draw[grid3, thin] (0,0,\z) -- (0,\n,\z);
%     \foreach \z in {0,1,...,\n}
%         \draw[grid3, thin] (0,0,\z) -- (\n,0,\z);
%     % 绘制坐标轴
%     \draw[thick,->] (0,0,0) -- (\n+1,0,0) node[anchor=north east]{$x$};
%     \draw[thick,->] (0,0,0) -- (0,\n+1,0) node[anchor=north west]{$y$};
%     \draw[thick,->] (0,0,0) -- (0,0,\n+1) node[anchor=south]{$z$};
% \end{tikzpicture}

\end{document}